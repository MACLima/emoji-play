<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emoji Crush</title>
  <meta name="theme-color" content="#0f172a" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --txt: #e5e7eb;
      --accent: #22d3ee;
      --accent-2: #a78bfa;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      height: 100%;
      background: var(--bg);
      color: var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans;
    }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }

    h1 {
      margin: 0 0 8px 0;
      font-size: clamp(1.2rem, 2.5vw, 1.8rem);
    }

    /* Navbar fina (mesma cara da p√°gina principal) */
    .navbar {
      display: flex;
      border-bottom: 1px solid rgba(255,255,255,0.15);
      margin-bottom: 16px;
    }
    .nav-item {
      flex: 1;
      background: none;
      border: none;
      color: var(--txt);
      font-size: 14px;
      padding: 8px 0;
      cursor: pointer;
      text-align: center;
      transition: background .2s;
    }
    .nav-item:hover { background: rgba(255,255,255,0.05); }
    .nav-item.active {
      color: var(--accent);
      font-weight: 600;
      border-bottom: 2px solid var(--accent);
    }

    .board-wrap {
      display: flex;
      justify-content: center;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 4px;
      background: var(--panel);
      padding: 4px;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,.3);
      user-select: none;
      touch-action: none; /* melhora gesto no mobile */
    }

    .cell {
      aspect-ratio: 1;
      font-size: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      cursor: pointer;
      transition: transform .1s, background .2s, box-shadow .2s;
      will-change: transform;
    }
    .cell:hover {
      transform: scale(1.06);
      background: rgba(255,255,255,0.1);
    }
    .cell.selected {
      outline: 2px solid var(--accent);
      box-shadow: 0 0 0 2px var(--accent) inset;
      background: rgba(34,211,238,0.1);
    }
    .cell.flash {
      animation: flash .25s ease;
    }
    @keyframes flash {
      0% { transform: scale(1); }
      50% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }

    .hint {
      opacity: .75;
      font-size: 12px;
      text-align: center;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Emoji Crush</h1>

    <!-- Navbar -->
    <nav class="navbar">
      <button class="nav-item" onclick="location.href='index.html'">Leitor</button>
      <button class="nav-item active" onclick="location.href='emojicrush.html'">Jogo</button>
    </nav>

    <div class="board-wrap">
      <div id="board" class="board" aria-label="Tabuleiro de emojis"></div>
    </div>

    <p class="hint">Toque em um emoji e depois em um vizinho para trocar. No mobile, um pequeno arrasto tamb√©m funciona.</p>
  </div>

  <script>
    // === Config ===
    const EMOJIS = ["üçé","üçå","üçá","üçì","üçç","üçä","üçí"];
    const SIZE = 8;

    // === Estado ===
    let board = [];          // board[y][x] => emoji
    let cells = [];          // cells[y][x] => elemento DOM
    let selected = null;     // {x,y, el}
    let dragStart = null;    // {x,y, clientX, clientY}

    // === Util ===
    const idx = (x, y) => y * SIZE + x;
    const inBounds = (x, y) => x >= 0 && x < SIZE && y >= 0 && y < SIZE;
    const randomEmoji = () => EMOJIS[Math.floor(Math.random() * EMOJIS.length)];

    function isAdjacent(a, b) {
      return Math.abs(a.x - b.x) + Math.abs(a.y - b.y) === 1;
    }

    function swapModel(a, b) {
      const tmp = board[a.y][a.x];
      board[a.y][a.x] = board[b.y][b.x];
      board[b.y][b.x] = tmp;
    }

    function renderSwap(a, b) {
      const ea = cells[a.y][a.x];
      const eb = cells[b.y][b.x];
      const tmpTxt = ea.textContent;
      ea.textContent = eb.textContent;
      eb.textContent = tmpTxt;
    
      ea.classList.add('flash');
      eb.classList.add('flash');
      playSwapSound();  // üîî toca aqui
      setTimeout(() => {
        ea.classList.remove('flash');
        eb.classList.remove('flash');
      }, 250);
    }

    function clearSelection() {
      if (selected?.el) selected.el.classList.remove('selected');
      selected = null;
    }

    function chooseCell(x, y) {
      const el = cells[y][x];
      if (!selected) {
        selected = { x, y, el };
        el.classList.add('selected');
        return;
      }
      const other = { x, y, el };
      if (selected.x === x && selected.y === y) {
        // clicou na mesma c√©lula -> desmarca
        clearSelection();
        return;
      }
      if (!isAdjacent(selected, other)) {
        // Troca a sele√ß√£o para o novo
        selected.el.classList.remove('selected');
        selected = other;
        selected.el.classList.add('selected');
        return;
      }
      // Adjacent -> faz swap
      swapModel(selected, other);
      renderSwap(selected, other);
      clearSelection();
    }

    // === Drag / Swipe ===
    function onPointerDown(e, x, y) {
      const touch = e.touches?.[0] || e;
      dragStart = { x, y, clientX: touch.clientX, clientY: touch.clientY };
      // marca sele√ß√£o para feedback
      if (!selected) {
        selected = { x, y, el: cells[y][x] };
        selected.el.classList.add('selected');
      }
    }

    function onPointerUp(e) {
      if (!dragStart) return;
      const touch = e.changedTouches?.[0] || e;
      const dx = touch.clientX - dragStart.clientX;
      const dy = touch.clientY - dragStart.clientY;

      // limiar m√≠nimo para considerar swipe
      const TH = 12; // px
      let nx = dragStart.x, ny = dragStart.y;

      if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > TH) {
        nx = dragStart.x + (dx > 0 ? 1 : -1);
      } else if (Math.abs(dy) > TH) {
        ny = dragStart.y + (dy > 0 ? 1 : -1);
      } else {
        // swipe muito curto: trata como clique simples (seleciona)
        chooseCell(dragStart.x, dragStart.y);
        dragStart = null;
        return;
      }

      if (inBounds(nx, ny)) {
        const a = { x: dragStart.x, y: dragStart.y, el: cells[dragStart.y][dragStart.x] };
        const b = { x: nx, y: ny, el: cells[ny][nx] };
        swapModel(a, b);
        renderSwap(a, b);
      }
      clearSelection();
      dragStart = null;
    }

    // === Board ===
    function createBoard() {
      board = Array.from({ length: SIZE }, () =>
        Array.from({ length: SIZE }, () => randomEmoji())
      );
    }

    function renderBoard() {
      const container = document.getElementById('board');
      container.style.gridTemplateColumns = `repeat(${SIZE}, 1fr)`;
      container.innerHTML = '';
      cells = Array.from({ length: SIZE }, () => Array(SIZE).fill(null));

      for (let y = 0; y < SIZE; y++) {
        for (let x = 0; x < SIZE; x++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.textContent = board[y][x];
          cell.dataset.x = x;
          cell.dataset.y = y;

          // Clique/Toque (seleciona e tenta trocar com adjacente)
          cell.addEventListener('click', () => chooseCell(x, y));

          // Suporte a arrastar (pointer/touch/mouse)
          cell.addEventListener('pointerdown', (e) => onPointerDown(e, x, y));
          cell.addEventListener('pointerup', onPointerUp);
          cell.addEventListener('touchstart', (e) => onPointerDown(e, x, y), { passive: true });
          cell.addEventListener('touchend', onPointerUp, { passive: true });
          cell.addEventListener('mousedown', (e) => onPointerDown(e, x, y));
          cell.addEventListener('mouseup', onPointerUp);

          container.appendChild(cell);
          cells[y][x] = cell;
        }
      }
    }

    const swapSound = document.getElementById('swap-sound');
    function playSwapSound() {
      if (swapSound) {
        swapSound.currentTime = 0;
        swapSound.play().catch(()=>{});
      }
    }
    
    // Init
    createBoard();
    renderBoard();
  </script>
  <audio id="swap-sound" src="https://cdn.jsdelivr.net/gh/MACLima/assets/audio/pop.mp3" preload="auto"></audio>
</body>
</html>
